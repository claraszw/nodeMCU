<html>

<head>
   <title>RPi Web Server</title>
   <!-- Latest compiled and minified CSS -->
   <link rel= "stylesheet" type= "text/css" href="{{ url_for('static', filename='style.css')}}">
   <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
   Optional theme
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous"> -->
   <!-- Latest compiled and minified JavaScript -->
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
   <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
   <script type="text/javascript" charset="utf-8">
      $(document).ready(function() {
        var socket = io.connect('http://' + document.domain + ':' + location.port);
        socket.on('connect', function() {
          socket.emit('my event', {data: 'I\'m connected!!!!'});
        });
        socket.on('luminosity', function(msg) {
          var nDate = new Date();
          $('#readingsUpdated').text(nDate.getHours() + 'h:' + nDate.getMinutes() +
             'm:' + nDate.getSeconds() + 's').html();
          $('#luminosity').text(msg.data).html();
        });
      });

      var threshold = 10

      function test (){

      	document.getElementById("newRuleDiv").style.visibility = 'hidden'
      	// console.log("Received: " + value)

      	// if(value.data < threshold){
      	// 	alert("Please choose a different value!")	
      	// }
      	
      	// alert("Done")
      }

   </script>
   <!-- <script src="{{url_for('static', filename='updates.js')}}"></script> -->
</head>


<body>

	<h1>Sala L516</h1>

	<h3>Luminosidade : <span id="luminosity">{{luminosity}}</span></h3>

	<br>
	<h3>Regras: </h3>

	{% if rules|length == 0 %}
		<span class="empty-label">Não há Regras</span>
	{% endif %}

	<ul>

	{% for rule in rules %}
		<div class="rules">
			<span>
				<li>{{rule["type"]["label"]}}</li>
				<ul>
					{% for parameter in rule["parameters"] %}
					<li>{{parameter["label"]}}: {{parameter["value"]}}</li>
					{% endfor %}
				</ul>
			</span>
			<form method = "POST" action="{{url_for('deleteRule')}}">
				<button name="btn" value="{{rule}}" class="button-delete">Excluir</button>
			</form>
		</div>
	{% endfor %}
	</ul>

	<div id="teste">Hello</div>

		<form method="POST" action="{{ url_for('new') }}">

			<div class="newRule" id="newRuleDiv">
				<span>Regra: 
				<!-- <select name="ruleType">
				{% for ruleType in ruleTypes %}
					<option value="{{ ruleType }}">{{ruleType["label"]}}</option>
				{% endfor %}
				</select> --></span>
			</div>
			<div class="hour">
				<span>De   :   <input class="hour-input" type="text" name="hourI" placeholder="09" pattern="[0-9]{2}"> : <input class="hour-input" type="text" name="minI" placeholder="00" pattern="[0-9]{2}" >
				<br> 
				<span>Até: <input class="hour-input" type="text" name="hourE" pattern="[0-9]{2}" placeholder="11"> : <input class="hour-input" type="text" name="minE" pattern="[0-9]{2}" placeholder="00" > </span>
			</div>
			<div class="conditions">

				<h4>Condições:</h4>

				{% if conditions|length == 0 %}
					<span class="empty-label">Não há Condições</span>
				{% endif %}

				<ul>
				{% for existingCondition in conditions %}
					<li>{{existingCondition["label"]}}: {{existingCondition["value"]}}</li>
				{% endfor %}
				</ul>
				
				{% if (newFlags["condition"]==True) %}
				
					{% if (newFlags["conditionType"]==True) %}
						<div> {{conditionsMessages[condition["type"]]}}
						<input type="number" name="conditionValue">
						<br>
						</div>
						<button class="button-newCondition-back" name="btn" value="conditionValueBack">Voltar</button>
						<button class="button-newCondition" type="submit" name="btn" value="createCondition">Adicionar Condição</button>
					{% else %}
						<div class="newConditions">
							<span>Condição: 
								<select name="conditionType">
								{% for existingConditionType in conditionTypes %}
									<option value="{{existingConditionType}}">{{existingConditionType["label"]}}</option>
								{% endfor %}
								</select>
							</span>
						</div>
							<button class="button-newCondition-back" name="btn" value="conditionTypeBack">Voltar</button>
							<button class="button-newCondition-next" name="btn" value="conditionType">Próximo</button>
						
					</form>
					{% endif %}

				{% else %}
					<br>
					<button class="button-newCondition" name="btn" value="condition" type="submit">Adicionar Nova Condição</button>
				{% endif %}

			</div>

			<button type="submit" name="btn" value="cancelCreateRule"> Cancelar </button> 
			<button type="submit" name="btn" value="createRule"> Criar Regra </button> 

		</form>
		
		<!-- <form  action="{{ url_for('new') }}" method="POST"> -->
		{{conditionTypes[0]['label']}}
			<button  class="button-newRule" name="btn" value="rule" onclick="test()"> Adicionar Nova Regra </button> 
		<!-- </form> -->

</body>
</html>